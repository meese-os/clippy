{"version":3,"file":"index.js","sources":["../src/queue.ts","../src/animator.ts","../src/utils.ts","../src/balloon.ts","../src/agent.ts","../src/agents/index.ts","../node_modules/.pnpm/rollup-plugin-styles@4.0.0_rollup@2.79.1/node_modules/rollup-plugin-styles/dist/runtime/inject-css.js","../src/index.ts","../src/load.ts"],"sourcesContent":["export default class Queue {\r\n  private _queue: Function[];\r\n  private _onEmptyCallback: any;\r\n  private _active: any;\r\n\r\n  constructor(onEmptyCallback: Function) {\r\n    this._queue = [];\r\n    this._onEmptyCallback = onEmptyCallback;\r\n  }\r\n\r\n  /**\r\n   * @param {function(Function)} func\r\n   * @returns {jQuery.Deferred}\r\n   */\r\n  public queue(func: Function) {\r\n    this._queue.push(func);\r\n\r\n    if (this._queue.length === 1 && !this._active) {\r\n      this._progressQueue();\r\n    }\r\n  }\r\n\r\n  private _progressQueue() {\r\n    // Stop if nothing left in queue\r\n    if (!this._queue.length) {\r\n      this._onEmptyCallback();\r\n      return;\r\n    }\r\n\r\n    let f = this._queue.shift();\r\n    this._active = true;\r\n\r\n    // execute function\r\n    let completeFunction = this.next.bind(this);\r\n    if (f) f(completeFunction);\r\n  }\r\n\r\n  public clear() {\r\n    this._queue = [];\r\n  }\r\n\r\n  public next() {\r\n    this._active = false;\r\n    this._progressQueue();\r\n  }\r\n}\r\n\r\n\r\n\r\n","import { AgentConfig, AgentWrapper, ClippyAnimation, ClippyFrame } from \"./types\";\r\n\r\n\r\nexport default class Animator {\r\n  public static States = { WAITING: 1, EXITED: 0 };\r\n\r\n  private _el: HTMLElement;\r\n  private _data: AgentConfig;\r\n  private _currentFrameIndex: number;\r\n  private _path: string;\r\n  private _exiting: boolean;\r\n  private _currentFrame?: ClippyFrame;\r\n  private _started: boolean;\r\n  private _sounds: Record<string, HTMLAudioElement>;\r\n  private _overlays: HTMLElement[];\r\n  private _endCallback?: Function;\r\n  private _currentAnimation?: ClippyAnimation;\r\n  private _loop?: number;\r\n\r\n  public currentAnimationName: string | undefined;\r\n\r\n  constructor (el: HTMLElement, config: AgentWrapper, sounds: Array<string>) {\r\n    this._el = el;\r\n    this._data = config.config;\r\n    this._path = config.image;\r\n    this._currentFrameIndex = 0;\r\n    this._currentFrame = undefined;\r\n    this._exiting = false;\r\n    this._currentAnimation = undefined;\r\n    this._endCallback = undefined;\r\n    this._started = false;\r\n    this._sounds = {};\r\n    this.currentAnimationName = undefined;\r\n    this.preloadSounds(sounds);\r\n    this._overlays = [this._el];\r\n    let curr = this._el;\r\n\r\n    this._setupElement(this._el);\r\n    for (let i = 1; i < this._data.overlayCount; i++) {\r\n      const divEl = document.createElement(\"div\");\r\n      let inner = this._setupElement(divEl);\r\n      curr.append(inner);\r\n      this._overlays.push(inner);\r\n      curr = inner;\r\n    }\r\n  }\r\n\r\n  private _setupElement (el: HTMLElement) {\r\n    let frameSize = this._data.framesize;\r\n    el.style.display = \"none\";\r\n    el.style.width = frameSize[0] + \"px\";\r\n    el.style.height = frameSize[1] + \"px\";\r\n    el.style.background = \"url('\" + this._path + \"') no-repeat\";\r\n    \r\n    return el;\r\n  }\r\n\r\n  animations () {\r\n    let r = [];\r\n    let d = this._data.animations;\r\n    for (let n in d) {\r\n      r.push(n);\r\n    }\r\n    return r;\r\n  }\r\n\r\n  preloadSounds (sounds: Array<string>) {\r\n    // for (let i = 0; i < this._data.sounds.length; i++) {\r\n    //   let snd: string = this._data.sounds[i];\r\n    //   let uri = sounds[snd];\r\n    //   if (!uri) continue;\r\n    //   this._sounds[snd] = new Audio(uri);\r\n\r\n    // }\r\n  }\r\n\r\n  hasAnimation (name: string) {\r\n    return !!this._data.animations[name];\r\n  }\r\n\r\n  exitAnimation () {\r\n    this._exiting = true;\r\n  }\r\n\r\n  showAnimation (animationName: string, stateChangeCallback: Function) {\r\n    this._exiting = false;\r\n\r\n    if (!this.hasAnimation(animationName)) {\r\n      return false;\r\n    }\r\n\r\n    this._currentAnimation = this._data.animations[animationName];\r\n    this.currentAnimationName = animationName;\r\n\r\n    if (!this._started) {\r\n      this._step();\r\n      this._started = true;\r\n    }\r\n\r\n    this._currentFrameIndex = 0;\r\n    this._currentFrame = undefined;\r\n    this._endCallback = stateChangeCallback;\r\n\r\n    return true;\r\n  }\r\n\r\n  private _draw () {\r\n    let images: Array<Array<number>> = [];\r\n    if (this._currentFrame) images = this._currentFrame.images || [];\r\n\r\n    for (let i = 0; i < this._overlays.length; i++) {\r\n      if (i < images.length) {\r\n        let xy = images[i];\r\n        let bg = -xy[0] + \"px \" + -xy[1] + \"px\";\r\n        this._overlays[i].style.backgroundPosition = bg;\r\n        this._overlays[i].style.display = \"block\";\r\n      }\r\n      else {\r\n        this._overlays[i].style.display = \"none\";\r\n      }\r\n    }\r\n  }\r\n\r\n  private _getNextAnimationFrame (): number {\r\n    if (!this._currentAnimation) return 0;\r\n    // No current frame. start animation.\r\n    if (!this._currentFrame) return 0;\r\n    let currentFrame = this._currentFrame;\r\n    let branching = this._currentFrame.branching;\r\n\r\n    if (this._exiting && currentFrame.exitBranch !== undefined) {\r\n      return currentFrame.exitBranch;\r\n    } else if (branching) {\r\n      let rnd = Math.random() * 100;\r\n      for (let i = 0; i < branching.branches.length; i++) {\r\n        let branch = branching.branches[i];\r\n        if (rnd <= branch.weight) {\r\n          return branch.frameIndex;\r\n        }\r\n\r\n        rnd -= branch.weight;\r\n      }\r\n    }\r\n\r\n    return this._currentFrameIndex + 1;\r\n  }\r\n\r\n  private _playSound () {\r\n    let s = this._currentFrame?.sound;\r\n    if (!s) return;\r\n    let audio = this._sounds[s];\r\n    if (audio) audio.play();\r\n  }\r\n\r\n  private _atLastFrame () {\r\n    if (!this._currentAnimation) return false;\r\n    return this._currentFrameIndex >= this._currentAnimation.frames.length - 1;\r\n  }\r\n\r\n  private _step () {\r\n    if (!this._currentAnimation) return;\r\n    let newFrameIndex = Math.min(this._getNextAnimationFrame(), this._currentAnimation.frames.length - 1);\r\n    let frameChanged = !this._currentFrame || this._currentFrameIndex !== newFrameIndex;\r\n    this._currentFrameIndex = newFrameIndex;\r\n\r\n    // always switch frame data, unless we're at the last frame of an animation with a useExitBranching flag.\r\n    if (!(this._atLastFrame() && this._currentAnimation.useExitBranching)) {\r\n      this._currentFrame = this._currentAnimation.frames[this._currentFrameIndex];\r\n    }\r\n\r\n    this._draw();\r\n    this._playSound();\r\n\r\n    this._loop = window.setTimeout(this._step.bind(this), this._currentFrame!.duration);\r\n\r\n    // fire events if the frames changed and we reached an end\r\n    if (this._endCallback && frameChanged && this._atLastFrame()) {\r\n      if (this._currentAnimation.useExitBranching && !this._exiting) {\r\n        this._endCallback(this.currentAnimationName, Animator.States.WAITING);\r\n      } else {\r\n        this._endCallback(this.currentAnimationName, Animator.States.EXITED);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Pause animation execution\r\n   */\r\n  pause () {\r\n    window.clearTimeout(this._loop);\r\n  }\r\n\r\n  /**\r\n   * Resume animation\r\n   */\r\n  resume () {\r\n    this._step();\r\n  }\r\n}\r\n\r\n\r\n","export const getWindowScroll = () => {\r\n  const supportPageOffset = window.pageXOffset !== undefined;\r\n  const isCSS1Compat = ((document.compatMode || \"\") === \"CSS1Compat\");\r\n\r\n  const scrollLeft = supportPageOffset ? window.pageXOffset : isCSS1Compat ? document.documentElement.scrollLeft : document.body.scrollLeft;\r\n  const scrollTop = supportPageOffset ? window.pageYOffset : isCSS1Compat ? document.documentElement.scrollTop : document.body.scrollTop;\r\n  return {\r\n    scrollLeft,\r\n    scrollTop\r\n  }\r\n}\r\n\r\nexport function getOffset(element: HTMLElement) {\r\n  if (!element.getClientRects().length) {\r\n    return { top: 0, left: 0 };\r\n  }\r\n\r\n  let rect = element.getBoundingClientRect();\r\n  let win = element.ownerDocument.defaultView || { pageXOffset: 0, pageYOffset: 0 };\r\n  return ({\r\n    top: rect.top + win.pageYOffset,\r\n    left: rect.left + win.pageXOffset\r\n  });\r\n}\r\n\r\nexport function getWidth(el: HTMLElement, type: \"inner\" | \"outer\" | \"width\" | \"full\") {\r\n  if (type === \"inner\") // .innerWidth()\r\n    return el.clientWidth;\r\n  else if (type === \"outer\") // .outerWidth()\r\n    return el.offsetWidth;\r\n  let s = window.getComputedStyle(el, null);\r\n  if (type === \"width\") // .width()\r\n    return el.clientWidth - parseInt(s.getPropertyValue(\"padding-left\")) - parseInt(s.getPropertyValue(\"padding-right\"));\r\n  else if (type === \"full\") // .outerWidth(includeMargins = true)\r\n    return el.offsetWidth + parseInt(s.getPropertyValue(\"margin-left\")) + parseInt(s.getPropertyValue(\"margin-right\"));\r\n  return null;\r\n}\r\n\r\n\r\nexport function getHeight(el: HTMLElement, type: \"inner\" | \"outer\" | \"height\" | \"full\") {\r\n  if (type === \"inner\") // .innerHeight()\r\n    return el.clientHeight;\r\n  else if (type === \"outer\") // .outerHeight()\r\n    return el.offsetHeight;\r\n  let s = window.getComputedStyle(el, null);\r\n  if (type === \"height\") // .height()\r\n    return el.clientHeight - parseInt(s.getPropertyValue(\"padding-top\")) - parseInt(s.getPropertyValue(\"padding-bottom\"));\r\n  else if (type === \"full\") // .outerWidth(includeMargins = true)\r\n    return el.offsetHeight + parseInt(s.getPropertyValue(\"margin-top\")) + parseInt(s.getPropertyValue(\"margin-bottom\"));\r\n  return null;\r\n}\r\n\r\n\r\n// Stub for jQuery.Deferred\r\nexport class Deferred {\r\n  public promise!: Promise<void>;\r\n  public resolve!: (value?: any) => void;\r\n  public reject!: (reason?: any) => void;\r\n\r\n  constructor () {\r\n    this.promise = new Promise((resolve, reject) => {\r\n      this.resolve = resolve;\r\n      this.reject = reject;\r\n    });\r\n  }\r\n}\r\n","import { getHeight, getOffset, getWidth, getWindowScroll } from \"./utils\";\r\nconst WORD_SPEAK_TIME: number = 200;\r\nconst CLOSE_BALLOON_DELAY = 2000;\r\nconst BALLOON_MARGIN = 15;\r\n\r\nexport default class Balloon {\r\n  private _targetEl: HTMLElement;\r\n  private _balloon?: HTMLElement;\r\n  private _content?: HTMLElement;\r\n  private _complete?: Function;\r\n\r\n  private _hiding: number | null = null;\r\n  private _loop: number | null = null;\r\n\r\n  private _hidden: boolean;\r\n  private _active: boolean = true;\r\n  private _hold: boolean = false;\r\n\r\n  private _addWord: (() => void) | null = null;\r\n  \r\n  constructor (targetEl: HTMLElement) {\r\n    this._targetEl = targetEl;\r\n    this._hidden = true;\r\n    this._setup();\r\n  }\r\n\r\n  private _setup () {\r\n    const balloonEl = document.createElement(\"div\");\r\n    balloonEl.className = \"clippy-balloon\";\r\n    balloonEl.setAttribute(\"hidden\", \"true\")\r\n    const tipEl = document.createElement(\"div\");\r\n    tipEl.className = \"clippy-tip\";\r\n    const contentEl = document.createElement(\"div\");\r\n    contentEl.className = \"clippy-content\";\r\n    balloonEl.appendChild(tipEl);\r\n    balloonEl.appendChild(contentEl);\r\n    this._balloon = balloonEl;\r\n    this._content = contentEl;\r\n\r\n    const targetEl = this._targetEl;\r\n    targetEl.insertAdjacentElement(\"afterend\", balloonEl);\r\n  }\r\n\r\n  public reposition () {\r\n    let sides = [\"top-left\", \"top-right\", \"bottom-left\", \"bottom-right\"];\r\n\r\n    for (let i = 0; i < sides.length; i++) {\r\n      let s = sides[i];\r\n      this._position(s);\r\n      if (!this._isOut()) break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param side\r\n   * @private\r\n   */\r\n  private _position (side: string) {\r\n    if (!this._balloon) return;\r\n\r\n    let o = getOffset(this._targetEl);\r\n    let h = getHeight(this._targetEl, \"height\")!;\r\n    let w = getWidth(this._targetEl, \"width\")!;\r\n\r\n\r\n    let {scrollLeft: sT, scrollTop: sL} = getWindowScroll();\r\n    o.top -= sT;\r\n    o.left -= sL;\r\n\r\n    let bH = getHeight(this._balloon, \"outer\")!;\r\n    let bW = getWidth(this._balloon, \"outer\")!; \r\n    \r\n    this._balloon.classList.remove(\"clippy-top-left\");\r\n    this._balloon.classList.remove(\"clippy-top-right\");\r\n    this._balloon.classList.remove(\"clippy-bottom-right\");\r\n    this._balloon.classList.remove(\"clippy-bottom-left\");\r\n\r\n    let left = 0, top = 0;\r\n    switch (side) {\r\n      case \"top-left\":\r\n        // Right side of the balloon next to the right side of the agent\r\n        left = o.left + w - bW;\r\n        top = o.top - bH - BALLOON_MARGIN;\r\n        break;\r\n      case \"top-right\":\r\n        // Left side of the balloon next to the left side of the agent\r\n        left = o.left;\r\n        top = o.top - bH - BALLOON_MARGIN;\r\n        break;\r\n      case \"bottom-right\":\r\n        // Right side of the balloon next to the right side of the agent\r\n        left = o.left;\r\n        top = o.top + h + BALLOON_MARGIN;\r\n        break;\r\n      case \"bottom-left\":\r\n        // Left side of the balloon next to the left side of the agent\r\n        left = o.left + w - bW;\r\n        top = o.top + h + BALLOON_MARGIN;\r\n        break;\r\n    }\r\n\r\n    this._balloon.style.top = top + \"px\";\r\n    this._balloon.style.left = left + \"px\";\r\n    this._balloon.classList.add(\"clippy-\" + side);\r\n  }\r\n\r\n  private _isOut () {\r\n    if (!this._balloon) return;\r\n    \r\n    let o = getOffset(this._balloon);\r\n    let bH = getHeight(this._balloon, \"outer\")!;\r\n    let bW = getWidth(this._balloon, \"outer\")!; \r\n\r\n    let wW = document.querySelector(\"html\")!.clientWidth; \r\n    let wH = document.querySelector(\"html\")!.clientHeight;\r\n    let {scrollLeft: sT, scrollTop: sL} = getWindowScroll();\r\n\r\n    let top = o.top - sT;\r\n    let left = o.left - sL;\r\n    let m = 5;\r\n    if (top - m < 0 || left - m < 0) return true;\r\n    return (top + bH + m) > wH || (left + bW + m) > wW;\r\n  }\r\n\r\n  public speak (complete: Function, text: string, hold: boolean) {\r\n    this._hidden = false;\r\n    this.show();\r\n    let c = this._content;\r\n\r\n    if (!c) return;\r\n    \r\n    // set height to auto\r\n    c.style.height = \"auto\";\r\n    c.style.width = \"auto\";\r\n\r\n    // add the text\r\n    c.innerHTML = text;\r\n    \r\n    // set height\r\n    c.style.height = c.style.height || \"\";\r\n    c.style.width = c.style.width || \"\";\r\n    c.innerHTML = \"\";\r\n    this.reposition();\r\n\r\n    this._complete = complete;\r\n    this._sayWords(text, hold, complete);\r\n  }\r\n\r\n  public show () {\r\n    if (!this._balloon) return;\r\n    if (this._hidden) return;\r\n    this._balloon.removeAttribute(\"hidden\");\r\n  }\r\n\r\n  public hide (fast?: boolean) {\r\n    if (fast) {\r\n      this._balloon?.setAttribute(\"hidden\", \"true\");\r\n      return;\r\n    }\r\n\r\n    this._hiding = window.setTimeout(this._finishHideBalloon.bind(this), CLOSE_BALLOON_DELAY);\r\n  }\r\n\r\n  private _finishHideBalloon () {\r\n    if (this._active) return;\r\n    this._balloon?.setAttribute(\"hidden\", \"true\");\r\n    this._hidden = true;\r\n    this._hiding = null;\r\n  }\r\n\r\n  private _sayWords (text: string, hold: boolean, complete: Function) {\r\n    this._active = true;\r\n    this._hold = hold;\r\n    let words = text.split(/[^\\S-]/);\r\n    let time = WORD_SPEAK_TIME;\r\n    let el = this._content;\r\n    let idx = 1;\r\n\r\n    this._addWord = () => {\r\n      if (!this._active) return;\r\n      if (idx > words.length) {\r\n        this._addWord = null;\r\n        this._active = false;\r\n        if (!this._hold) {\r\n          complete();\r\n          this.hide(false);\r\n        }\r\n      } else {\r\n        if (el) el.innerHTML = words.slice(0, idx).join(\" \");\r\n        idx++;\r\n        // @ts-ignore\r\n        this._loop = window.setTimeout(this._addWord?.bind(this), time);\r\n      }\r\n    };\r\n\r\n    this._addWord();\r\n  }\r\n\r\n  public close () {\r\n    if (this._active) {\r\n      this._hold = false;\r\n    } else if (this._hold && this._complete) {\r\n      this._complete();\r\n    }\r\n  }\r\n\r\n  public pause () {\r\n    if (this._loop) {\r\n      window.clearTimeout(this._loop);\r\n    }\r\n    if (this._hiding) {\r\n      window.clearTimeout(this._hiding);\r\n      this._hiding = null;\r\n    }\r\n  }\r\n\r\n  public resume () {\r\n    if (this._addWord) {\r\n      this._addWord();\r\n    } else if (!this._hold && !this._hidden) {\r\n      this._hiding = window.setTimeout(this._finishHideBalloon.bind(this), CLOSE_BALLOON_DELAY);\r\n    }\r\n  }\r\n}\r\n\r\n\r\n","import Queue from \"./queue\";\r\nimport Animator from \"./animator\";\r\nimport Balloon from \"./balloon\";\r\nimport { AgentWrapper } from \"./types\";\r\nimport { Deferred, getHeight, getOffset, getWidth, getWindowScroll } from \"./utils\";\r\n\r\nexport interface AgentOptions {\r\n  agent: AgentWrapper;\r\n  selector?: string;\r\n}\r\n\r\nexport default class Agent {\r\n  private _queue: Queue;\r\n  private _el: HTMLElement;\r\n  private _animator: Animator;\r\n  private _balloon: Balloon;\r\n  private _hidden: boolean = false;\r\n  private _idleDfd?: Deferred;\r\n  private _offset: { top: number; left: number; } = { top: 0, left: 0 };\r\n  private _dragUpdateLoop?: number;\r\n  private _targetX?: number;\r\n  private _targetY?: number;\r\n  private _moveHandle?: ((e: MouseEvent) => void); \r\n  private _upHandle?: ((e: MouseEvent) => void); \r\n\r\n  constructor (options: AgentOptions) {\r\n    const {\r\n      agent,\r\n      selector\r\n    } = options;\r\n\r\n    this._queue = new Queue(this._onQueueEmpty.bind(this));\r\n\r\n    const el = document.createElement(\"div\");\r\n    el.className = \"clippy\";\r\n    el.setAttribute(\"hidden\", \"true\");\r\n    this._el = el;\r\n\r\n    let selectorEl = selector ? document.getElementsByClassName(selector)[0] : undefined;\r\n    (selectorEl || document.body).appendChild(this._el);\r\n\r\n    this._animator = new Animator(this._el, agent, []);\r\n    this._balloon = new Balloon(this._el);\r\n    this._setupEvents();\r\n  }\r\n\r\n  /**\r\n   * @param {Number} x\r\n   * @param {Number} y\r\n   */\r\n  gestureAt (x: number, y: number) {\r\n    let d = this._getDirection(x, y);\r\n    let gAnim = \"Gesture\" + d;\r\n    let lookAnim = \"Look\" + d;\r\n\r\n    let animation = this.hasAnimation(gAnim) ? gAnim : lookAnim;\r\n    return this.play(animation);\r\n  }\r\n\r\n  /**\r\n   * @param {Boolean=} fast\r\n   */\r\n  hide (fast: boolean, callback: () => void) {\r\n    this._hidden = true;\r\n    let el = this._el;\r\n    this.stop();\r\n    if (fast) {\r\n      this._el.setAttribute(\"hidden\", \"true\");\r\n      this.stop();\r\n      this.pause();\r\n      if (callback) callback();\r\n      return;\r\n    }\r\n\r\n    return this._playInternal(\"Hide\",  () => {\r\n      this._el.setAttribute(\"hidden\", \"true\");\r\n      this.pause();\r\n      if (callback) callback();\r\n    });\r\n  }\r\n\r\n  moveTo (x: number, y: number, duration: number) {\r\n    let dir = this._getDirection(x, y);\r\n    let anim = \"Move\" + dir;\r\n    if (duration === undefined) duration = 1000;\r\n\r\n    this._addToQueue( (complete: Function) => {\r\n      // The simple case\r\n      if (duration === 0) {\r\n        this._el.style.top = y + \"px\";\r\n        this._el.style.left = x + \"px\";\r\n        this.reposition();\r\n        complete();\r\n        return;\r\n      }\r\n\r\n      // No animations\r\n      if (!this.hasAnimation(anim)) {\r\n        const endHandler = () => {\r\n          this._el.removeEventListener(\"animationend\", endHandler);\r\n          complete();\r\n        }\r\n        this._el.addEventListener(\"animationend\", endHandler);\r\n        this._el.animate({ top: y, left: x }, {\r\n          duration,\r\n          iterations: 1,\r\n        });\r\n        return;\r\n      }\r\n\r\n      let callback =  (name: string, state: number) => {\r\n        // When exited, complete\r\n        if (state === Animator.States.EXITED) {\r\n          complete();\r\n        }\r\n        // If waiting\r\n        if (state === Animator.States.WAITING) {\r\n          const endHandler = () => {\r\n            this._el.removeEventListener(\"animationend\", endHandler);\r\n            this._animator.exitAnimation();;\r\n          }\r\n          this._el.addEventListener(\"animationend\", endHandler);\r\n          this._el.animate({ top: y + \"px\", left: x + \"px\"}, {\r\n            duration,\r\n            iterations: 1,\r\n          });\r\n        }\r\n      };\r\n\r\n      this._playInternal(anim, callback);\r\n    }, this);\r\n  }\r\n\r\n  private _playInternal (animation: any, callback: Function) {\r\n    // If we're inside an idle animation\r\n    if (this._isIdleAnimation() && this._idleDfd) {\r\n      this._idleDfd.promise.finally(() => {\r\n        this._playInternal(animation, callback);\r\n      });\r\n    }\r\n\r\n    this._animator.showAnimation(animation, callback);\r\n  }\r\n\r\n  play (animation: any, timeout?: number, cb?: Function) {\r\n    if (!this.hasAnimation(animation)) return false;\r\n    if (timeout === undefined) timeout = 5000;\r\n\r\n    this._addToQueue( (complete: Function) => {\r\n      let completed = false;\r\n      // Handle callback\r\n      let callback = function (name: string, state: number) {\r\n        if (state === Animator.States.EXITED) {\r\n          completed = true;\r\n          if (cb) cb();\r\n          complete();\r\n        }\r\n      };\r\n\r\n      // If has timeout, register a timeout function\r\n      if (timeout) {\r\n        window.setTimeout(() => {\r\n          if (completed) return;\r\n          // Exit after timeout\r\n          this._animator.exitAnimation();\r\n        }, timeout);\r\n      }\r\n\r\n      this._playInternal(animation, callback);\r\n    }, this);\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * @param {Boolean=} fast\r\n   */\r\n  show (fast: boolean = true) {\r\n    this._hidden = false;\r\n    if (fast) {\r\n      this._el.removeAttribute(\"hidden\");\r\n      this.resume();\r\n      this._onQueueEmpty();\r\n      return;\r\n    }\r\n\r\n    const cssTop = this._el.style.top;\r\n    const cssLeft = this._el.style.left;\r\n    if (cssTop === \"auto\" || !(cssLeft === \"auto\")){\r\n      let wW = document.querySelector(\"html\")!.clientWidth; \r\n      let wH = document.querySelector(\"html\")!.clientHeight;\r\n      let { scrollLeft: sT } = getWindowScroll();\r\n      let left = wW * 0.8;\r\n      let top = (wH + sT) * 0.8;\r\n      this._el.style.top = top + \"px\";\r\n      this._el.style.left = left + \"px\";\r\n    }\r\n\r\n    this.resume();\r\n    return this.play(\"Show\");\r\n  }\r\n\r\n  /**\r\n   * @param {String} text\r\n   */\r\n  speak (text: string, hold: boolean = false) {\r\n    this._addToQueue( (complete: Function) => {\r\n      this._balloon.speak(complete, text, hold);\r\n    }, this);\r\n  }\r\n\r\n\r\n  /**\r\n   * Close the current balloon\r\n   */\r\n  closeBalloon () {\r\n    this._balloon.hide();\r\n  }\r\n\r\n  delay (time: number) {\r\n    time = time || 250;\r\n\r\n    this._addToQueue( (complete: Function) => {\r\n      this._onQueueEmpty();\r\n      window.setTimeout(complete, time);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Skips the current animation\r\n   */\r\n  stopCurrent () {\r\n    this._animator.exitAnimation();\r\n    this._balloon.close();\r\n  }\r\n\r\n\r\n  stop () {\r\n    // Clear the queue\r\n    this._queue.clear();\r\n    this._animator.exitAnimation();\r\n    this._balloon.hide();\r\n  }\r\n\r\n  /**\r\n   * @param {String} name\r\n   * @returns {Boolean}\r\n   */\r\n  hasAnimation (name: string) {\r\n    return this._animator.hasAnimation(name);\r\n  }\r\n\r\n  /**\r\n   * Gets a list of animation names\r\n   * @return {Array.<string>}\r\n   */\r\n  animations () {\r\n    return this._animator.animations();\r\n  }\r\n\r\n  /**\r\n   * Play a random animation\r\n   * @return {Deferred}\r\n   */\r\n  animate (): any {\r\n    let animations = this.animations();\r\n    let anim = animations[Math.floor(Math.random() * animations.length)];\r\n    // skip idle animations\r\n    if (anim.indexOf(\"Idle\") === 0) {\r\n      return this.animate();\r\n    }\r\n    return this.play(anim);\r\n  }\r\n\r\n  /**************************** Utils ************************************/\r\n\r\n  /**\r\n   * @param {Number} x\r\n   * @param {Number} y\r\n   * @return {String}\r\n   * @private\r\n   */\r\n  private _getDirection (x: number, y: number) {\r\n    let offset = getOffset(this._el);\r\n    let h = getHeight(this._el, \"height\")!;\r\n    let w = getWidth(this._el, \"width\")!;\r\n\r\n    let centerX = (offset.left + w / 2);\r\n    let centerY = (offset.top + h / 2);\r\n\r\n    let a = centerY - y;\r\n    let b = centerX - x;\r\n\r\n    let r = Math.round((180 * Math.atan2(a, b)) / Math.PI);\r\n\r\n    // Left and Right are for the character, not the screen :-/\r\n    if (-45 <= r && r < 45) return \"Right\";\r\n    if (45 <= r && r < 135) return \"Up\";\r\n    if (135 <= r && r <= 180 || -180 <= r && r < -135) return \"Left\";\r\n    if (-135 <= r && r < -45) return \"Down\";\r\n\r\n    // sanity check\r\n    return \"Top\";\r\n  }\r\n\r\n  /**************************** Queue and Idle handling ************************************/\r\n\r\n  /**\r\n   * Handle empty queue.\r\n   * We need to transition the animation to an idle state\r\n   * @private\r\n   */\r\n  private _onQueueEmpty () {\r\n    if (this._hidden || this._isIdleAnimation()) return;\r\n    let idleAnim = this._getIdleAnimation();\r\n    this._idleDfd = new Deferred();\r\n\r\n    this._animator.showAnimation(idleAnim, this._onIdleComplete.bind(this));\r\n  }\r\n\r\n  private _onIdleComplete (name: string, state: number) {\r\n    if (state === Animator.States.EXITED) {\r\n      this._idleDfd?.resolve(undefined);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Is the current animation state Idle?\r\n   * @return {Boolean}\r\n   * @private\r\n   */\r\n  private _isIdleAnimation () {\r\n    let c = this._animator.currentAnimationName;\r\n    return c && c.indexOf(\"Idle\") === 0;\r\n  }\r\n\r\n  /**\r\n   * Gets a random Idle animation\r\n   * @return {String}\r\n   * @private\r\n   */\r\n  private _getIdleAnimation () {\r\n    let animations = this.animations();\r\n    let r = [];\r\n    for (let i = 0; i < animations.length; i++) {\r\n      let a = animations[i];\r\n      if (a.indexOf(\"Idle\") === 0) {\r\n        r.push(a);\r\n      }\r\n    }\r\n\r\n    // Pick one\r\n    let idx = Math.floor(Math.random() * r.length);\r\n    return r[idx];\r\n  }\r\n\r\n  /**************************** Events ************************************/\r\n\r\n  private _setupEvents () {\r\n    window.addEventListener(\"resize\", this.reposition.bind(this));\r\n    this._el.addEventListener(\"mousedown\", this._onMouseDown.bind(this));\r\n    this._el.addEventListener(\"dblclick\", this._onDoubleClick.bind(this));\r\n  }\r\n\r\n  private _onDoubleClick () {\r\n    if (!this.play(\"ClickedOn\")) {\r\n      this.animate();\r\n    }\r\n  }\r\n\r\n  reposition () {\r\n    if (!(this._el.getAttribute(\"hidden\") === \"true\")) return;\r\n    let o = getOffset(this._el);\r\n    let bH = getHeight(this._el, \"outer\")!;\r\n    let bW = getWidth(this._el, \"outer\")!; \r\n\r\n    let wW = document.querySelector(\"html\")!.clientWidth; \r\n    let wH = document.querySelector(\"html\")!.clientHeight;\r\n    let {scrollLeft: sT, scrollTop: sL} = getWindowScroll();\r\n\r\n    let top = o.top - sT;\r\n    let left = o.left - sL;\r\n    let m = 5;\r\n    if (top - m < 0) {\r\n      top = m;\r\n    } else if ((top + bH + m) > wH) {\r\n      top = wH - bH - m;\r\n    }\r\n\r\n    if (left - m < 0) {\r\n      left = m;\r\n    } else if (left + bW + m > wW) {\r\n      left = wW - bW - m;\r\n    }\r\n\r\n    this._el.style.left = left + \"px\";\r\n    this._el.style.top = top + \"px\";\r\n\r\n    // Reposition balloon\r\n    this._balloon.reposition();\r\n  }\r\n\r\n  private _onMouseDown (e: MouseEvent) {\r\n    e.preventDefault();\r\n    this._startDrag(e);\r\n  }\r\n\r\n  /**************************** Drag ************************************/\r\n\r\n  private _startDrag (e: MouseEvent) {\r\n    // Pause animations\r\n    this.pause();\r\n    this._balloon.hide(true);\r\n    this._offset = this._calculateClickOffset(e);\r\n\r\n    this._moveHandle = this._dragMove.bind(this);\r\n    this._upHandle = this._finishDrag.bind(this);\r\n\r\n    window.addEventListener(\"mousemove\", this._moveHandle);\r\n    window.addEventListener(\"mouseup\", this._upHandle);\r\n\r\n    this._dragUpdateLoop = window.setTimeout(this._updateLocation.bind(this), 10);\r\n  }\r\n\r\n  private _calculateClickOffset (e: MouseEvent) {\r\n    let mouseX = e.pageX;\r\n    let mouseY = e.pageY;\r\n    let o = getOffset(this._el);\r\n    return {\r\n      top: mouseY - o.top,\r\n      left: mouseX - o.left\r\n    };\r\n  }\r\n\r\n  private _updateLocation () {\r\n    this._el.style.top = (this._targetY || 0) + \"px\";\r\n    this._el.style.left = (this._targetX || 0) + \"px\";\r\n    this._dragUpdateLoop = window.setTimeout(this._updateLocation.bind(this), 10);\r\n  }\r\n\r\n  private _dragMove (e: MouseEvent) {\r\n    e.preventDefault();\r\n    let x = e.clientX - this._offset.left;\r\n    let y = e.clientY - this._offset.top;\r\n    this._targetX = x;\r\n    this._targetY = y;\r\n  }\r\n\r\n  private _finishDrag () {\r\n    window.clearTimeout(this._dragUpdateLoop);\r\n    // Remove handles\r\n    if (this._moveHandle) {\r\n      window.removeEventListener(\"mousemove\", this._moveHandle);\r\n    }\r\n    if (this._upHandle) {\r\n      window.removeEventListener(\"mouseup\", this._upHandle);\r\n    }\r\n    // Resume animations\r\n    this._balloon.show();\r\n    this.reposition();\r\n    this.resume();\r\n  }\r\n\r\n  private _addToQueue (func: Function, scope?: any) {\r\n    if (scope) func = func.bind(scope);\r\n    this._queue.queue(func);\r\n  }\r\n\r\n  /**************************** Pause and Resume ************************************/\r\n\r\n  pause () {\r\n    this._animator.pause();\r\n    this._balloon.pause();\r\n  }\r\n\r\n  resume () {\r\n    this._animator.resume();\r\n    this._balloon.resume();\r\n  }\r\n}\r\n","import { AgentType } from \"../types\";\r\n\r\nfunction loadAgent (name: AgentType) {\r\n  return new Promise<any>((resolve, reject) => {\r\n    import(`./agents/${name}.js`).then(module => {\r\n      resolve(module.default);\r\n    }).catch(err => {\r\n      reject(err);\r\n    });\r\n  });\r\n}\r\n\r\nexport const agents: Record<string, any> = {\r\n  Bonzi: () => loadAgent(\"Bonzi\"),\r\n  Clippy: () => loadAgent(\"Clippy\"),\r\n  F1: () => loadAgent(\"F1\"),\r\n  Genie: () => loadAgent(\"Genie\"),\r\n  Genius: () => loadAgent(\"Genius\"),\r\n  Links: () => loadAgent(\"Links\"),\r\n  Merlin: () => loadAgent(\"Merlin\"),\r\n  Peedy: () => loadAgent(\"Peedy\"),\r\n  Rocky: () => loadAgent(\"Rocky\"),\r\n  Rover: () => loadAgent(\"Rover\"),\r\n};\r\n","var e=[],t=[];function n(n,r){if(n&&\"undefined\"!=typeof document){var a,s=!0===r.prepend?\"prepend\":\"append\",d=!0===r.singleTag,i=\"string\"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName(\"head\")[0];if(d){var u=e.indexOf(i);-1===u&&(u=e.push(i)-1,t[u]={}),a=t[u]&&t[u][s]?t[u][s]:t[u][s]=c()}else a=c();65279===n.charCodeAt(0)&&(n=n.substring(1)),a.styleSheet?a.styleSheet.cssText+=n:a.appendChild(document.createTextNode(n))}function c(){var e=document.createElement(\"style\");if(e.setAttribute(\"type\",\"text/css\"),r.attributes)for(var t=Object.keys(r.attributes),n=0;n<t.length;n++)e.setAttribute(t[n],r.attributes[t[n]]);var a=\"prepend\"===s?\"afterbegin\":\"beforeend\";return i.insertAdjacentElement(a,e),e}}export{n as default};\n","import type Agent from \"./agent\";\r\nimport type Animator from \"./animator\";\r\nimport type Queue from \"./queue\";\r\nimport type Balloon from \"./balloon\";\r\nimport { load } from \"./load\";\r\nimport { AgentType, AgentWrapper, Clippy } from \"./types\";\r\nimport \"./clippy.css\";\r\n\r\nconst clippy: Clippy = {\r\n  load,\r\n  agents: {} as Record<AgentType, AgentWrapper>,\r\n}\r\n\r\nexport type { Agent, Animator, Queue, Balloon };\r\nexport default clippy;\r\n","import Agent from \"./agent\"\r\nimport { agents } from \"./agents\";\r\nimport { AgentWrapper, LoadOptions } from \"./types\";\r\n\r\nexport const load = (options: LoadOptions) => {\r\n  const {\r\n    name,\r\n    successCb,\r\n    failCb,\r\n    selector,\r\n  } = options || {};\r\n\r\n  // Wrapper to the success callback\r\n  agents[name]().then((agentConfig: AgentWrapper) => {\r\n    const a = new Agent({\r\n      agent: agentConfig,\r\n      selector\r\n    });\r\n    if (successCb) successCb(a);\r\n  }).catch((error: any) => {\r\n    if (failCb) failCb(error);\r\n  });\r\n\r\n}\r\n"],"names":["Queue","onEmptyCallback","this","_queue","_onEmptyCallback","queue","func","push","length","_active","_progressQueue","prototype","let","f","shift","completeFunction","next","bind","clear","Animator","el","config","sounds","_el","_data","_path","image","_currentFrameIndex","_currentFrame","undefined","_exiting","_currentAnimation","_endCallback","_started","_sounds","currentAnimationName","preloadSounds","_overlays","curr","_setupElement","i","overlayCount","const","divEl","document","createElement","inner","append","frameSize","framesize","style","display","width","height","background","animations","r","d","n","hasAnimation","name","exitAnimation","showAnimation","animationName","stateChangeCallback","_step","_draw","images","xy","bg","backgroundPosition","_getNextAnimationFrame","currentFrame","branching","exitBranch","rnd","Math","random","branches","branch","weight","frameIndex","_playSound","s","_a","sound","audio","play","_atLastFrame","frames","newFrameIndex","min","frameChanged","useExitBranching","_loop","window","setTimeout","duration","States","WAITING","EXITED","pause","clearTimeout","resume","getWindowScroll","supportPageOffset","pageXOffset","isCSS1Compat","compatMode","documentElement","scrollLeft","body","pageYOffset","scrollTop","getOffset","element","getClientRects","top","left","rect","getBoundingClientRect","win","ownerDocument","defaultView","getWidth","type","clientWidth","offsetWidth","getComputedStyle","parseInt","getPropertyValue","getHeight","clientHeight","offsetHeight","Deferred","promise","Promise","resolve","reject","Balloon","targetEl","_hiding","_hold","_addWord","_targetEl","_hidden","_setup","balloonEl","className","setAttribute","tipEl","contentEl","appendChild","_balloon","_content","insertAdjacentElement","reposition","sides","_position","_isOut","side","o","h","w","ref","sT","sL","bH","bW","classList","remove","add","wW","querySelector","wH","speak","complete","text","hold","show","c","innerHTML","_complete","_sayWords","removeAttribute","hide","fast","_finishHideBalloon","words","split","idx","slice","join","close","Agent","options","_offset","agent","selector","_onQueueEmpty","getElementsByClassName","_animator","_setupEvents","loadAgent","import","then","module","default","catch","err","gestureAt","x","y","_getDirection","gAnim","lookAnim","animation","callback","stop","_playInternal","moveTo","anim","_addToQueue","endHandler","removeEventListener","addEventListener","animate","iterations","state","_isIdleAnimation","_idleDfd","finally","timeout","cb","completed","cssTop","cssLeft","closeBalloon","delay","time","stopCurrent","floor","indexOf","offset","centerX","a","b","round","atan2","PI","idleAnim","_getIdleAnimation","_onIdleComplete","_onMouseDown","_onDoubleClick","getAttribute","e","preventDefault","_startDrag","_calculateClickOffset","_moveHandle","_dragMove","_upHandle","_finishDrag","_dragUpdateLoop","_updateLocation","mouseX","pageX","mouseY","pageY","_targetY","_targetX","clientX","clientY","scope","agents","Bonzi","Clippy","F1","Genie","Genius","Links","Merlin","Peedy","Rocky","Rover","t","prepend","singleTag","container","getElementsByTagName","u","charCodeAt","substring","styleSheet","cssText","createTextNode","attributes","Object","keys","clippy","successCb","failCb","agentConfig","error"],"mappings":"AAAc,IAAOA,EAKnB,SAAYC,GACVC,KAAKC,OAAS,GACdD,KAAKE,iBAAmBH,CAC1B,cAMOI,MAAK,SAACC,GACXJ,KAAKC,OAAOI,KAAKD,GAEU,IAAvBJ,KAAKC,OAAOK,QAAiBN,KAAKO,SACpCP,KAAKQ,gBAET,EAEQV,EAAAW,UAAAD,eAAA,WAEN,GAAKR,KAAKC,OAAOK,OAAjB,CAKAI,IAAIC,EAAIX,KAAKC,OAAOW,QACpBZ,KAAKO,SAAU,EAGfG,IAAIG,EAAmBb,KAAKc,KAAKC,KAAKf,MAClCW,GAAGA,EAAEE,EAPR,MAFCb,KAAKE,kBAUT,EAEOJ,EAAAW,UAAAO,MAAA,WACLhB,KAAKC,OAAS,EAChB,EAEOH,EAAAW,UAAAK,KAAA,WACLd,KAAKO,SAAU,EACfP,KAAKQ,gBACP,ECzCF,IAAqBS,EAkBnB,SAAaC,EAAiBC,EAAsBC,GAClDpB,KAAKqB,IAAMH,EACXlB,KAAKsB,MAAQH,EAAOA,OACpBnB,KAAKuB,MAAQJ,EAAOK,MACpBxB,KAAKyB,mBAAqB,EAC1BzB,KAAK0B,mBAAgBC,EACrB3B,KAAK4B,UAAW,EAChB5B,KAAK6B,uBAAoBF,EACzB3B,KAAK8B,kBAAeH,EACpB3B,KAAK+B,UAAW,EAChB/B,KAAKgC,QAAU,GACfhC,KAAKiC,0BAAuBN,EAC5B3B,KAAKkC,cAAcd,GACnBpB,KAAKmC,UAAY,CAACnC,KAAKqB,KACvBX,IAAI0B,EAAOpC,KAAKqB,IAEhBrB,KAAKqC,cAAcrC,KAAKqB,KACxB,IAAKX,IAAI4B,EAAI,EAAGA,EAAItC,KAAKsB,MAAMiB,aAAcD,IAAK,CAChDE,IAAMC,EAAQC,SAASC,cAAc,OACjCC,EAAQ5C,KAAKqC,cAAcI,GAC/BL,EAAKS,OAAOD,GACZ5C,KAAKmC,UAAU9B,KAAKuC,GACpBR,EAAOQ,CACR,CACH,cAEQP,cAAa,SAAEnB,GACrBR,IAAIoC,EAAY9C,KAAKsB,MAAMyB,UAM3B,OALA7B,EAAG8B,MAAMC,QAAU,OACnB/B,EAAG8B,MAAME,MAAQJ,EAAU,GAAK,KAChC5B,EAAG8B,MAAMG,OAASL,EAAU,GAAK,KACjC5B,EAAG8B,MAAMI,WAAa,QAAUpD,KAAKuB,MAAQ,eAEtCL,CACT,EAEAD,EAAAR,UAAA4C,WAAA,WACE3C,IAAI4C,EAAI,GACJC,EAAIvD,KAAKsB,MAAM+B,WACnB,IAAK3C,IAAI8C,KAAKD,EACZD,EAAEjD,KAAKmD,GAET,OAAOF,CACT,cAEApB,cAAa,SAAEd,GAQf,cAEAqC,aAAY,SAAEC,GACZ,QAAS1D,KAAKsB,MAAM+B,WAAWK,EACjC,EAEAzC,EAAAR,UAAAkD,cAAA,WACE3D,KAAK4B,UAAW,CAClB,EAEAX,EAAAR,UAAAmD,cAAA,SAAeC,EAAuBC,GAGpC,OAFA9D,KAAK4B,UAAW,IAEX5B,KAAKyD,aAAaI,KAIvB7D,KAAK6B,kBAAoB7B,KAAKsB,MAAM+B,WAAWQ,GAC/C7D,KAAKiC,qBAAuB4B,EAEvB7D,KAAK+B,WACR/B,KAAK+D,QACL/D,KAAK+B,UAAW,GAGlB/B,KAAKyB,mBAAqB,EAC1BzB,KAAK0B,mBAAgBC,EACrB3B,KAAK8B,aAAegC,GAEb,EACT,EAEQ7C,EAAAR,UAAAuD,MAAA,WACNtD,IAAIuD,EAA+B,GAC/BjE,KAAK0B,gBAAeuC,EAASjE,KAAK0B,cAAcuC,QAAU,IAE9D,IAAKvD,IAAI4B,EAAI,EAAGA,EAAItC,KAAKmC,UAAU7B,OAAQgC,IACzC,GAAIA,EAAI2B,EAAO3D,OAAQ,CACrBI,IAAIwD,EAAKD,EAAO3B,GACZ6B,GAAMD,EAAG,GAAK,OAASA,EAAG,GAAK,KACnClE,KAAKmC,UAAUG,GAAGU,MAAMoB,mBAAqBD,EAC7CnE,KAAKmC,UAAUG,GAAGU,MAAMC,QAAU,OACnC,MAECjD,KAAKmC,UAAUG,GAAGU,MAAMC,QAAU,MAGxC,EAEQhC,EAAAR,UAAA4D,uBAAA,WACN,IAAKrE,KAAK6B,kBAAmB,OAAO,EAEpC,IAAK7B,KAAK0B,cAAe,OAAO,EAChChB,IAAI4D,EAAetE,KAAK0B,cACpB6C,EAAYvE,KAAK0B,cAAc6C,UAEnC,GAAIvE,KAAK4B,eAAwCD,IAA5B2C,EAAaE,WAChC,OAAOF,EAAaE,WACf,GAAID,EAET,IADA7D,IAAI+D,EAAsB,IAAhBC,KAAKC,SACNrC,EAAI,EAAGA,EAAIiC,EAAUK,SAAStE,OAAQgC,IAAK,CAClD5B,IAAImE,EAASN,EAAUK,SAAStC,GAChC,GAAImC,GAAOI,EAAOC,OAChB,OAAOD,EAAOE,WAGhBN,GAAOI,EAAOC,MACf,CAGH,OAAO9E,KAAKyB,mBAAqB,CACnC,EAEQR,EAAAR,UAAAuE,WAAA,iBACFC,EAAsB,QAAlBC,EAAAlF,KAAK0B,qBAAa,IAAAwD,OAAA,EAAAA,EAAEC,MAC5B,GAAKF,EAAL,CACAvE,IAAI0E,EAAQpF,KAAKgC,QAAQiD,GACrBG,GAAOA,EAAMC,MAFF,CAGjB,EAEQpE,EAAAR,UAAA6E,aAAA,WACN,QAAKtF,KAAK6B,mBACH7B,KAAKyB,oBAAsBzB,KAAK6B,kBAAkB0D,OAAOjF,OAAS,CAC3E,EAEQW,EAAAR,UAAAsD,MAAA,WACN,GAAK/D,KAAK6B,kBAAV,CACAnB,IAAI8E,EAAgBd,KAAKe,IAAIzF,KAAKqE,yBAA0BrE,KAAK6B,kBAAkB0D,OAAOjF,OAAS,GAC/FoF,GAAgB1F,KAAK0B,eAAiB1B,KAAKyB,qBAAuB+D,EACtExF,KAAKyB,mBAAqB+D,EAGpBxF,KAAKsF,gBAAkBtF,KAAK6B,kBAAkB8D,mBAClD3F,KAAK0B,cAAgB1B,KAAK6B,kBAAkB0D,OAAOvF,KAAKyB,qBAG1DzB,KAAKgE,QACLhE,KAAKgF,aAELhF,KAAK4F,MAAQC,OAAOC,WAAW9F,KAAK+D,MAAMhD,KAAKf,MAAOA,KAAK0B,cAAeqE,UAGtE/F,KAAK8B,cAAgB4D,GAAgB1F,KAAKsF,iBACxCtF,KAAK6B,kBAAkB8D,mBAAqB3F,KAAK4B,SACnD5B,KAAK8B,aAAa9B,KAAKiC,qBAAsBhB,EAAS+E,OAAOC,SAE7DjG,KAAK8B,aAAa9B,KAAKiC,qBAAsBhB,EAAS+E,OAAOE,QApB7B,CAuBtC,EAKAjF,EAAAR,UAAA0F,MAAA,WACEN,OAAOO,aAAapG,KAAK4F,MAC3B,EAKA3E,EAAAR,UAAA4F,OAAA,WACErG,KAAK+D,OACP,EAjMc9C,EAAM+E,OAAG,CAAEC,QAAS,EAAGC,OAAQ,GCJxC1D,IAAM8D,EAAe,WAC1B9D,IAAM+D,OAA2C5E,IAAvBkE,OAAOW,YAC3BC,EAAgD,gBAA/B/D,SAASgE,YAAc,IAI9C,MAAO,YAFYH,EAAoBV,OAAOW,YAAcC,EAAe/D,SAASiE,gBAAgBC,WAAalE,SAASmE,KAAKD,qBAC7GL,EAAoBV,OAAOiB,YAAcL,EAAe/D,SAASiE,gBAAgBI,UAAYrE,SAASmE,KAAKE,UAK/H,EAEM,SAAUC,EAAUC,GACxB,IAAKA,EAAQC,iBAAiB5G,OAC5B,MAAO,CAAE6G,IAAK,EAAGC,KAAM,GAGzB1G,IAAI2G,EAAOJ,EAAQK,wBACfC,EAAMN,EAAQO,cAAcC,aAAe,CAAEjB,YAAa,EAAGM,YAAa,GAC9E,MAAQ,CACNK,IAAKE,EAAKF,IAAMI,EAAIT,YACpBM,KAAMC,EAAKD,KAAOG,EAAIf,YAE1B,CAEgB,SAAAkB,EAASxG,EAAiByG,GACxC,GAAa,UAATA,EACF,OAAOzG,EAAG0G,YACP,GAAa,UAATD,EACP,OAAOzG,EAAG2G,YACZnH,IAAIuE,EAAIY,OAAOiC,iBAAiB5G,EAAI,MACpC,MAAa,UAATyG,EACKzG,EAAG0G,YAAcG,SAAS9C,EAAE+C,iBAAiB,iBAAmBD,SAAS9C,EAAE+C,iBAAiB,kBACnF,SAATL,EACAzG,EAAG2G,YAAcE,SAAS9C,EAAE+C,iBAAiB,gBAAkBD,SAAS9C,EAAE+C,iBAAiB,iBAC7F,IACT,CAGgB,SAAAC,EAAU/G,EAAiByG,GACzC,GAAa,UAATA,EACF,OAAOzG,EAAGgH,aACP,GAAa,UAATP,EACP,OAAOzG,EAAGiH,aACZzH,IAAIuE,EAAIY,OAAOiC,iBAAiB5G,EAAI,MACpC,MAAa,WAATyG,EACKzG,EAAGgH,aAAeH,SAAS9C,EAAE+C,iBAAiB,gBAAkBD,SAAS9C,EAAE+C,iBAAiB,mBACnF,SAATL,EACAzG,EAAGiH,aAAeJ,SAAS9C,EAAE+C,iBAAiB,eAAiBD,SAAS9C,EAAE+C,iBAAiB,kBAC7F,IACT,KAIaI,EAKX,sBACEpI,KAAKqI,QAAU,IAAIC,SAAO,SAAEC,EAASC,GACnCxI,EAAKuI,QAAUA,EACfvI,EAAKwI,OAASA,CAChB,GACF,EC3DmBC,EAenB,SAAaC,GATL1I,KAAO2I,QAAkB,KACzB3I,KAAK4F,MAAkB,KAGvB5F,KAAOO,SAAY,EACnBP,KAAK4I,OAAY,EAEjB5I,KAAQ6I,SAAwB,KAGtC7I,KAAK8I,UAAYJ,EACjB1I,KAAK+I,SAAU,EACf/I,KAAKgJ,QACP,EAEQP,EAAAhI,UAAAuI,OAAA,WACNxG,IAAMyG,EAAYvG,SAASC,cAAc,OACzCsG,EAAUC,UAAY,iBACtBD,EAAUE,aAAa,SAAU,QACjC3G,IAAM4G,EAAQ1G,SAASC,cAAc,OACrCyG,EAAMF,UAAY,aAClB1G,IAAM6G,EAAY3G,SAASC,cAAc,OACzC0G,EAAUH,UAAY,iBACtBD,EAAUK,YAAYF,GACtBH,EAAUK,YAAYD,GACtBrJ,KAAKuJ,SAAWN,EAChBjJ,KAAKwJ,SAAWH,EAECrJ,KAAK8I,UACbW,sBAAsB,WAAYR,EAC7C,EAEOR,EAAAhI,UAAAiJ,WAAA,WAGL,IAFAhJ,IAAIiJ,EAAQ,CAAC,WAAY,YAAa,cAAe,gBAE5CrH,EAAI,EAAGA,EAAIqH,EAAMrJ,OAAQgC,IAAK,CACrC5B,IAAIuE,EAAI0E,EAAMrH,GAEd,GADAtC,KAAK4J,UAAU3E,IACVjF,KAAK6J,SAAU,KACrB,CACH,cAMQD,UAAS,SAAEE,GACjB,GAAK9J,KAAKuJ,SAAV,CAEA7I,IAAIqJ,EAAI/C,EAAUhH,KAAK8I,WACnBkB,EAAI/B,EAAUjI,KAAK8I,UAAW,UAC9BmB,EAAIvC,EAAS1H,KAAK8I,UAAW,SAGjCoB,EAAsC5D,IAArB6D,EAAAD,EAAAtD,WAAuCwD,EAAAF,EAAAnD,UACxDgD,EAAE5C,KAAOgD,EACTJ,EAAE3C,MAAQgD,EAEV1J,IAAI2J,EAAKpC,EAAUjI,KAAKuJ,SAAU,SAC9Be,EAAK5C,EAAS1H,KAAKuJ,SAAU,SAEjCvJ,KAAKuJ,SAASgB,UAAUC,OAAO,mBAC/BxK,KAAKuJ,SAASgB,UAAUC,OAAO,oBAC/BxK,KAAKuJ,SAASgB,UAAUC,OAAO,uBAC/BxK,KAAKuJ,SAASgB,UAAUC,OAAO,sBAE/B9J,IAAI0G,EAAO,EAAGD,EAAM,EACpB,OAAQ2C,GACN,IAAK,WAEH1C,EAAO2C,EAAE3C,KAAO6C,EAAIK,EACpBnD,EAAM4C,EAAE5C,IAAMkD,EA/EC,GAgFf,MACF,IAAK,YAEHjD,EAAO2C,EAAE3C,KACTD,EAAM4C,EAAE5C,IAAMkD,EApFC,GAqFf,MACF,IAAK,eAEHjD,EAAO2C,EAAE3C,KACTD,EAAM4C,EAAE5C,IAAM6C,EAzFC,GA0Ff,MACF,IAAK,cAEH5C,EAAO2C,EAAE3C,KAAO6C,EAAIK,EACpBnD,EAAM4C,EAAE5C,IAAM6C,EA9FC,GAkGnBhK,KAAKuJ,SAASvG,MAAMmE,IAAMA,EAAM,KAChCnH,KAAKuJ,SAASvG,MAAMoE,KAAOA,EAAO,KAClCpH,KAAKuJ,SAASgB,UAAUE,IAAI,UAAYX,EA7Cb,CA8C7B,EAEQrB,EAAAhI,UAAAoJ,OAAA,WACN,GAAK7J,KAAKuJ,SAAV,CAEA7I,IAAIqJ,EAAI/C,EAAUhH,KAAKuJ,UACnBc,EAAKpC,EAAUjI,KAAKuJ,SAAU,SAC9Be,EAAK5C,EAAS1H,KAAKuJ,SAAU,SAE7BmB,EAAKhI,SAASiI,cAAc,QAAS/C,YACrCgD,EAAKlI,SAASiI,cAAc,QAASzC,aACzCgC,EAAsC5D,IAArB6D,EAAAD,EAAAtD,WAAuCwD,EAAAF,EAAAnD,UAEpDI,EAAM4C,EAAE5C,IAAMgD,EACd/C,EAAO2C,EAAE3C,KAAOgD,EAEpB,OAAIjD,EADI,EACM,GAAKC,EADX,EACsB,IACtBD,EAAMkD,EAFN,EAEgBO,GAAOxD,EAAOkD,EAF9B,EAEwCI,EAdrB,CAe7B,EAEOjC,EAAAhI,UAAAoK,MAAA,SAAOC,EAAoBC,EAAcC,GAC9ChL,KAAK+I,SAAU,EACf/I,KAAKiL,OACLvK,IAAIwK,EAAIlL,KAAKwJ,SAER0B,IAGLA,EAAElI,MAAMG,OAAS,OACjB+H,EAAElI,MAAME,MAAQ,OAGhBgI,EAAEC,UAAYJ,EAGdG,EAAElI,MAAMG,OAAS+H,EAAElI,MAAMG,QAAU,GACnC+H,EAAElI,MAAME,MAAQgI,EAAElI,MAAME,OAAS,GACjCgI,EAAEC,UAAY,GACdnL,KAAK0J,aAEL1J,KAAKoL,UAAYN,EACjB9K,KAAKqL,UAAUN,EAAMC,EAAMF,GAC7B,EAEOrC,EAAAhI,UAAAwK,KAAA,WACAjL,KAAKuJ,WACNvJ,KAAK+I,SACT/I,KAAKuJ,SAAS+B,gBAAgB,UAChC,cAEOC,KAAI,SAAEC,SACPA,EACa,QAAftG,EAAAlF,KAAKuJ,gBAAU,IAAArE,GAAAA,EAAAiE,aAAa,SAAU,QAIxCnJ,KAAK2I,QAAU9C,OAAOC,WAAW9F,KAAKyL,mBAAmB1K,KAAKf,MA9JtC,IA+J1B,EAEQyI,EAAAhI,UAAAgL,mBAAA,iBACFzL,KAAKO,UACM,QAAf2E,EAAAlF,KAAKuJ,gBAAU,IAAArE,GAAAA,EAAAiE,aAAa,SAAU,QACtCnJ,KAAK+I,SAAU,EACf/I,KAAK2I,QAAU,KACjB,EAEQF,EAAAhI,UAAA4K,UAAA,SAAWN,EAAcC,EAAeF,cAC9C9K,KAAKO,SAAU,EACfP,KAAK4I,MAAQoC,EACbtK,IAAIgL,EAAQX,EAAKY,MAAM,UAEnBzK,EAAKlB,KAAKwJ,SACVoC,EAAM,EAEV5L,KAAK6I,SAAQ,iBACN7I,EAAKO,UACNqL,EAAMF,EAAMpL,QACdN,EAAK6I,SAAW,KAChB7I,EAAKO,SAAU,EACVP,EAAK4I,QACRkC,IACA9K,EAAKuL,MAAK,MAGRrK,IAAIA,EAAGiK,UAAYO,EAAMG,MAAM,EAAGD,GAAKE,KAAK,MAChDF,IAEA5L,EAAK4F,MAAQC,OAAOC,WAAwB,QAAbZ,EAAAlF,EAAK6I,gBAAQ,IAAA3D,OAAA,EAAAA,EAAEnE,KAAKf,GA9L3B,MAgM5B,EAEAA,KAAK6I,UACP,EAEOJ,EAAAhI,UAAAsL,MAAA,WACD/L,KAAKO,QACPP,KAAK4I,OAAQ,EACJ5I,KAAK4I,OAAS5I,KAAKoL,WAC5BpL,KAAKoL,WAET,EAEO3C,EAAAhI,UAAA0F,MAAA,WACDnG,KAAK4F,OACPC,OAAOO,aAAapG,KAAK4F,OAEvB5F,KAAK2I,UACP9C,OAAOO,aAAapG,KAAK2I,SACzB3I,KAAK2I,QAAU,KAEnB,EAEOF,EAAAhI,UAAA4F,OAAA,WACDrG,KAAK6I,SACP7I,KAAK6I,WACK7I,KAAK4I,OAAU5I,KAAK+I,UAC9B/I,KAAK2I,QAAU9C,OAAOC,WAAW9F,KAAKyL,mBAAmB1K,KAAKf,MA1NxC,KA4N1B,ECnNY,IAAOgM,EAcnB,SAAaC,GATLjM,KAAO+I,SAAY,EAEnB/I,KAAOkM,QAAmC,CAAE/E,IAAK,EAAGC,KAAM,GAS9D,IAAA+E,EAAAF,EAAAE,MAEUC,EAAAH,EAAAG,SAEZpM,KAAKC,OAAS,IAAIH,EAAME,KAAKqM,cAActL,KAAKf,OAEhDwC,IAAMtB,EAAKwB,SAASC,cAAc,OAClCzB,EAAGgI,UAAY,SACfhI,EAAGiI,aAAa,SAAU,QAC1BnJ,KAAKqB,IAAMH,IAEMkL,EAAW1J,SAAS4J,uBAAuBF,GAAU,QAAKzK,IAC5De,SAASmE,MAAMyC,YAAYtJ,KAAKqB,KAE/CrB,KAAKuM,UAAY,IAAItL,EAASjB,KAAKqB,IAAK8K,EAAO,IAC/CnM,KAAKuJ,SAAW,IAAId,EAAQzI,KAAKqB,KACjCrB,KAAKwM,cACP,EC1CF,SAASC,EAAW/I,GAClB,OAAO,IAAI4E,SAAO,SAAOC,EAASC,GAChCkE,OAAO,YAAYhJ,EAAI,OAAOiJ,MAAK,SAAAC,GACjCrE,EAAQqE,EAAOC,QACjB,IAAGC,OAAK,SAACC,GACPvE,EAAOuE,EACT,GACF,GACF,CDwCEf,EAAAvL,UAAAuM,UAAA,SAAWC,EAAWC,GACpBxM,IAAI6C,EAAIvD,KAAKmN,cAAcF,EAAGC,GAC1BE,EAAQ,UAAY7J,EACpB8J,EAAW,OAAS9J,EAEpB+J,EAAYtN,KAAKyD,aAAa2J,GAASA,EAAQC,EACnD,OAAOrN,KAAKqF,KAAKiI,EACnB,EAKAtB,EAAAvL,UAAA8K,KAAA,SAAMC,EAAe+B,cAInB,OAHAvN,KAAK+I,SAAU,EACN/I,KAAKqB,IACdrB,KAAKwN,OACDhC,GACFxL,KAAKqB,IAAI8H,aAAa,SAAU,QAChCnJ,KAAKwN,OACLxN,KAAKmG,aACDoH,GAAUA,MAITvN,KAAKyN,cAAc,mBACxBzN,EAAKqB,IAAI8H,aAAa,SAAU,QAChCnJ,EAAKmG,QACDoH,GAAUA,GAChB,GACF,EAEAvB,EAAAvL,UAAAiN,OAAA,SAAQT,EAAWC,EAAWnH,cAExB4H,EAAO,OADD3N,KAAKmN,cAAcF,EAAGC,QAEfvL,IAAboE,IAAwBA,EAAW,KAEvC/F,KAAK4N,aAAa,SAAC9C,GAEjB,GAAiB,IAAb/E,EAKF,OAJA/F,EAAKqB,IAAI2B,MAAMmE,IAAM+F,EAAI,KACzBlN,EAAKqB,IAAI2B,MAAMoE,KAAO6F,EAAI,KAC1BjN,EAAK0J,kBACLoB,IAKF,IAAK9K,EAAKyD,aAAakK,GAAO,CAC5BnL,IAAMqL,EAAU,WACd7N,EAAKqB,IAAIyM,oBAAoB,eAAgBD,GAC7C/C,GACF,EAMA,OALA9K,EAAKqB,IAAI0M,iBAAiB,eAAgBF,QAC1C7N,EAAKqB,IAAI2M,QAAQ,CAAE7G,IAAK+F,EAAG9F,KAAM6F,GAAK,UACpClH,EACAkI,WAAY,GAGf,CAqBDjO,EAAKyN,cAAcE,GAnBP,SAAKjK,EAAcwK,GAM7B,GAJIA,IAAUjN,EAAS+E,OAAOE,QAC5B4E,IAGEoD,IAAUjN,EAAS+E,OAAOC,QAAS,CACrCzD,IAAMqL,EAAU,WACd7N,EAAKqB,IAAIyM,oBAAoB,eAAgBD,GAC7C7N,EAAKuM,UAAU5I,eACjB,EACA3D,EAAKqB,IAAI0M,iBAAiB,eAAgBF,GAC1C7N,EAAKqB,IAAI2M,QAAQ,CAAE7G,IAAK+F,EAAI,KAAM9F,KAAM6F,EAAI,MAAO,UACjDlH,EACAkI,WAAY,GAEf,CACH,GAGD,GAAEjO,KACL,EAEQgM,EAAAvL,UAAAgN,cAAA,SAAeH,EAAgBC,cAEjCvN,KAAKmO,oBAAsBnO,KAAKoO,UAClCpO,KAAKoO,SAAS/F,QAAQgG,oBACpBrO,EAAKyN,cAAcH,EAAWC,EAChC,IAGFvN,KAAKuM,UAAU3I,cAAc0J,EAAWC,EAC1C,EAEAvB,EAAAvL,UAAA4E,KAAA,SAAMiI,EAAgBgB,EAAkBC,cACtC,QAAKvO,KAAKyD,aAAa6J,UACP3L,IAAZ2M,IAAuBA,EAAU,KAErCtO,KAAK4N,aAAa,SAAC9C,GACjBpK,IAAI8N,GAAY,EAWZF,GACFzI,OAAOC,YAAU,WACX0I,GAEJxO,EAAKuM,UAAU5I,eAChB,GAAE2K,GAGLtO,EAAKyN,cAAcH,GAjBJ,SAAU5J,EAAcwK,GACjCA,IAAUjN,EAAS+E,OAAOE,SAC5BsI,GAAY,EACRD,GAAIA,IACRzD,IAEJ,GAYD,GAAE9K,OAEI,EACT,cAKAiL,KAAI,SAAEO,GAEJ,mBAFoB,GACpBxL,KAAK+I,SAAU,EACXyC,EAIF,OAHAxL,KAAKqB,IAAIiK,gBAAgB,UACzBtL,KAAKqG,cACLrG,KAAKqM,gBAIP7J,IAAMiM,EAASzO,KAAKqB,IAAI2B,MAAMmE,IACxBuH,EAAU1O,KAAKqB,IAAI2B,MAAMoE,KAC/B,GAAe,SAAXqH,GAAmC,SAAZC,EAAoB,CAC7ChO,IAGI0G,EAAY,GAHP1E,SAASiI,cAAc,QAAS/C,YAIrCT,EAAkB,IAHbzE,SAASiI,cAAc,QAASzC,aAChB5B,IAAkBM,YAG3C5G,KAAKqB,IAAI2B,MAAMmE,IAAMA,EAAM,KAC3BnH,KAAKqB,IAAI2B,MAAMoE,KAAOA,EAAO,IAC9B,CAGD,OADApH,KAAKqG,SACErG,KAAKqF,KAAK,OACnB,EAKA2G,EAAAvL,UAAAoK,MAAA,SAAOE,EAAcC,8BAAgB,GACnChL,KAAK4N,aAAa,SAAC9C,GACjB9K,EAAKuJ,SAASsB,MAAMC,EAAUC,EAAMC,EACrC,GAAEhL,KACL,EAMAgM,EAAAvL,UAAAkO,aAAA,WACE3O,KAAKuJ,SAASgC,MAChB,cAEAqD,MAAK,SAAEC,cACLA,EAAOA,GAAQ,IAEf7O,KAAK4N,aAAa,SAAC9C,GACjB9K,EAAKqM,gBACLxG,OAAOC,WAAWgF,EAAU+D,EAC9B,GACF,EAKA7C,EAAAvL,UAAAqO,YAAA,WACE9O,KAAKuM,UAAU5I,gBACf3D,KAAKuJ,SAASwC,OAChB,EAGAC,EAAAvL,UAAA+M,KAAA,WAEExN,KAAKC,OAAOe,QACZhB,KAAKuM,UAAU5I,gBACf3D,KAAKuJ,SAASgC,MAChB,cAMA9H,aAAY,SAAEC,GACZ,OAAO1D,KAAKuM,UAAU9I,aAAaC,EACrC,EAMAsI,EAAAvL,UAAA4C,WAAA,WACE,OAAOrD,KAAKuM,UAAUlJ,YACxB,EAMA2I,EAAAvL,UAAAuN,QAAA,WACEtN,IAAI2C,EAAarD,KAAKqD,aAClBsK,EAAOtK,EAAWqB,KAAKqK,MAAMrK,KAAKC,SAAWtB,EAAW/C,SAE5D,OAA6B,IAAzBqN,EAAKqB,QAAQ,QACRhP,KAAKgO,UAEPhO,KAAKqF,KAAKsI,EACnB,EAUQ3B,EAAAvL,UAAA0M,cAAA,SAAeF,EAAWC,GAChCxM,IAAIuO,EAASjI,EAAUhH,KAAKqB,KACxB2I,EAAI/B,EAAUjI,KAAKqB,IAAK,UACxB4I,EAAIvC,EAAS1H,KAAKqB,IAAK,SAEvB6N,EAAWD,EAAO7H,KAAO6C,EAAI,EAG7BkF,EAFWF,EAAO9H,IAAM6C,EAAI,EAEdkD,EACdkC,EAAIF,EAAUjC,EAEd3J,EAAIoB,KAAK2K,MAAO,IAAM3K,KAAK4K,MAAMH,EAAGC,GAAM1K,KAAK6K,IAGnD,OAAK,IAAMjM,GAAKA,EAAI,GAAW,QAC3B,IAAMA,GAAKA,EAAI,IAAY,KAC3B,KAAOA,GAAKA,GAAK,MAAQ,KAAOA,GAAKA,GAAK,IAAY,QACrD,KAAOA,GAAKA,GAAK,GAAW,OAG1B,KACT,EASQ0I,EAAAvL,UAAA4L,cAAA,WACN,IAAIrM,KAAK+I,UAAW/I,KAAKmO,mBAAzB,CACAzN,IAAI8O,EAAWxP,KAAKyP,oBACpBzP,KAAKoO,SAAW,IAAIhG,EAEpBpI,KAAKuM,UAAU3I,cAAc4L,EAAUxP,KAAK0P,gBAAgB3O,KAAKf,MAJb,CAKtD,EAEQgM,EAAAvL,UAAAiP,gBAAA,SAAiBhM,EAAcwK,SACjCA,IAAUjN,EAAS+E,OAAOE,SACf,QAAbhB,EAAAlF,KAAKoO,gBAAQ,IAAAlJ,GAAAA,EAAEqD,aAAQ5G,GAE3B,EAOQqK,EAAAvL,UAAA0N,iBAAA,WACNzN,IAAIwK,EAAIlL,KAAKuM,UAAUtK,qBACvB,OAAOiJ,GAA2B,IAAtBA,EAAE8D,QAAQ,OACxB,EAOQhD,EAAAvL,UAAAgP,kBAAA,WAGN,IAFA/O,IAAI2C,EAAarD,KAAKqD,aAClBC,EAAI,GACChB,EAAI,EAAGA,EAAIe,EAAW/C,OAAQgC,IAAK,CAC1C5B,IAAIyO,EAAI9L,EAAWf,GACO,IAAtB6M,EAAEH,QAAQ,SACZ1L,EAAEjD,KAAK8O,EAEV,CAID,OAAO7L,EADGoB,KAAKqK,MAAMrK,KAAKC,SAAWrB,EAAEhD,QAEzC,EAIQ0L,EAAAvL,UAAA+L,aAAA,WACN3G,OAAOkI,iBAAiB,SAAU/N,KAAK0J,WAAW3I,KAAKf,OACvDA,KAAKqB,IAAI0M,iBAAiB,YAAa/N,KAAK2P,aAAa5O,KAAKf,OAC9DA,KAAKqB,IAAI0M,iBAAiB,WAAY/N,KAAK4P,eAAe7O,KAAKf,MACjE,EAEQgM,EAAAvL,UAAAmP,eAAA,WACD5P,KAAKqF,KAAK,cACbrF,KAAKgO,SAET,EAEAhC,EAAAvL,UAAAiJ,WAAA,WACE,GAA0C,SAApC1J,KAAKqB,IAAIwO,aAAa,UAA5B,CACAnP,IAAIqJ,EAAI/C,EAAUhH,KAAKqB,KACnBgJ,EAAKpC,EAAUjI,KAAKqB,IAAK,SACzBiJ,EAAK5C,EAAS1H,KAAKqB,IAAK,SAExBqJ,EAAKhI,SAASiI,cAAc,QAAS/C,YACrCgD,EAAKlI,SAASiI,cAAc,QAASzC,aACzCgC,EAAsC5D,IAArB6D,EAAAD,EAAAtD,WAAuCwD,EAAAF,EAAAnD,UAEpDI,EAAM4C,EAAE5C,IAAMgD,EACd/C,EAAO2C,EAAE3C,KAAOgD,EAEhBjD,EADI,EACM,EACZA,EAFM,EAGIA,EAAMkD,EAHV,EAGoBO,IAC1BzD,EAAMyD,EAAKP,EAJL,GAOJjD,EAPI,EAOO,EACbA,EARM,EASGA,EAAOkD,EATV,EASmBI,IACzBtD,EAAOsD,EAAKJ,EAVN,GAaRtK,KAAKqB,IAAI2B,MAAMoE,KAAOA,EAAO,KAC7BpH,KAAKqB,IAAI2B,MAAMmE,IAAMA,EAAM,KAG3BnH,KAAKuJ,SAASG,YA5B4C,CA6B5D,cAEQiG,aAAY,SAAEG,GACpBA,EAAEC,iBACF/P,KAAKgQ,WAAWF,EAClB,cAIQE,WAAU,SAAEF,GAElB9P,KAAKmG,QACLnG,KAAKuJ,SAASgC,MAAK,GACnBvL,KAAKkM,QAAUlM,KAAKiQ,sBAAsBH,GAE1C9P,KAAKkQ,YAAclQ,KAAKmQ,UAAUpP,KAAKf,MACvCA,KAAKoQ,UAAYpQ,KAAKqQ,YAAYtP,KAAKf,MAEvC6F,OAAOkI,iBAAiB,YAAa/N,KAAKkQ,aAC1CrK,OAAOkI,iBAAiB,UAAW/N,KAAKoQ,WAExCpQ,KAAKsQ,gBAAkBzK,OAAOC,WAAW9F,KAAKuQ,gBAAgBxP,KAAKf,MAAO,GAC5E,cAEQiQ,sBAAqB,SAAEH,GAC7BpP,IAAI8P,EAASV,EAAEW,MACXC,EAASZ,EAAEa,MACX5G,EAAI/C,EAAUhH,KAAKqB,KACvB,MAAO,CACL8F,IAAKuJ,EAAS3G,EAAE5C,IAChBC,KAAMoJ,EAASzG,EAAE3C,KAErB,EAEQ4E,EAAAvL,UAAA8P,gBAAA,WACNvQ,KAAKqB,IAAI2B,MAAMmE,KAAOnH,KAAK4Q,UAAY,GAAK,KAC5C5Q,KAAKqB,IAAI2B,MAAMoE,MAAQpH,KAAK6Q,UAAY,GAAK,KAC7C7Q,KAAKsQ,gBAAkBzK,OAAOC,WAAW9F,KAAKuQ,gBAAgBxP,KAAKf,MAAO,GAC5E,cAEQmQ,UAAS,SAAEL,GACjBA,EAAEC,iBACFrP,IAAIuM,EAAI6C,EAAEgB,QAAU9Q,KAAKkM,QAAQ9E,KAC7B8F,EAAI4C,EAAEiB,QAAU/Q,KAAKkM,QAAQ/E,IACjCnH,KAAK6Q,SAAW5D,EAChBjN,KAAK4Q,SAAW1D,CAClB,EAEQlB,EAAAvL,UAAA4P,YAAA,WACNxK,OAAOO,aAAapG,KAAKsQ,iBAErBtQ,KAAKkQ,aACPrK,OAAOiI,oBAAoB,YAAa9N,KAAKkQ,aAE3ClQ,KAAKoQ,WACPvK,OAAOiI,oBAAoB,UAAW9N,KAAKoQ,WAG7CpQ,KAAKuJ,SAAS0B,OACdjL,KAAK0J,aACL1J,KAAKqG,QACP,EAEQ2F,EAAAvL,UAAAmN,YAAA,SAAaxN,EAAgB4Q,GAC/BA,IAAO5Q,EAAOA,EAAKW,KAAKiQ,IAC5BhR,KAAKC,OAAOE,MAAMC,EACpB,EAIA4L,EAAAvL,UAAA0F,MAAA,WACEnG,KAAKuM,UAAUpG,QACfnG,KAAKuJ,SAASpD,OAChB,EAEA6F,EAAAvL,UAAA4F,OAAA,WACErG,KAAKuM,UAAUlG,SACfrG,KAAKuJ,SAASlD,QAChB,ECldK7D,IAAMyO,EAA8B,CACzCC,MAAO,WAAA,OAAMzE,EAAU,QAAQ,EAC/B0E,OAAQ,WAAA,OAAM1E,EAAU,SAAS,EACjC2E,GAAI,WAAA,OAAM3E,EAAU,KAAK,EACzB4E,MAAO,WAAA,OAAM5E,EAAU,QAAQ,EAC/B6E,OAAQ,WAAA,OAAM7E,EAAU,SAAS,EACjC8E,MAAO,WAAA,OAAM9E,EAAU,QAAQ,EAC/B+E,OAAQ,WAAA,OAAM/E,EAAU,SAAS,EACjCgF,MAAO,WAAA,OAAMhF,EAAU,QAAQ,EAC/BiF,MAAO,WAAA,OAAMjF,EAAU,QAAQ,EAC/BkF,MAAO,WAAA,OAAMlF,EAAU,QAAQ,GCtB7BqD,EAAE,GAAG8B,EAAE,IAAG,SAAWpO,EAAEF,GAAG,GAAGE,GAAG,oBAAoBd,SAAS,CAAC,IAAIyM,EAAElK,GAAE,IAAK3B,EAAEuO,QAAQ,UAAU,SAAStO,GAAE,IAAKD,EAAEwO,UAAUxP,EAAE,iBAAiBgB,EAAEyO,UAAUrP,SAASiI,cAAcrH,EAAEyO,WAAWrP,SAASsP,qBAAqB,QAAQ,GAAG,GAAGzO,EAAE,CAAC,IAAI0O,EAAEnC,EAAEd,QAAQ1M,IAAI,IAAI2P,IAAIA,EAAEnC,EAAEzP,KAAKiC,GAAG,EAAEsP,EAAEK,GAAG,CAAA,GAAI9C,EAAEyC,EAAEK,IAAIL,EAAEK,GAAGhN,GAAG2M,EAAEK,GAAGhN,GAAG2M,EAAEK,GAAGhN,GAAGiG,GAAG,MAAMiE,EAAEjE,IAAI,QAAQ1H,EAAE0O,WAAW,KAAK1O,EAAEA,EAAE2O,UAAU,IAAIhD,EAAEiD,WAAWjD,EAAEiD,WAAWC,SAAS7O,EAAE2L,EAAE7F,YAAY5G,SAAS4P,eAAe9O,GAAG,CAAC,SAAS0H,IAAI,IAAI4E,EAAEpN,SAASC,cAAc,SAAS,GAAGmN,EAAE3G,aAAa,OAAO,YAAY7F,EAAEiP,WAAW,IAAI,IAAIX,EAAEY,OAAOC,KAAKnP,EAAEiP,YAAY/O,EAAE,EAAEA,EAAEoO,EAAEtR,OAAOkD,IAAIsM,EAAE3G,aAAayI,EAAEpO,GAAGF,EAAEiP,WAAWX,EAAEpO,KAAK,IAAI2L,EAAE,YAAYlK,EAAE,aAAa,YAAY,OAAO3C,EAAEmH,sBAAsB0F,EAAEW,GAAGA,CAAC,CAAC,y7CCQruB,IAAM4C,EAAiB,MCJH,SAACzG,GAMlB,IAAA/B,EAAG+B,GAAW,GAJbvI,EAAAwG,EAAAxG,KACAiP,EAAAzI,EAAAyI,UACAC,EAAA1I,EAAA0I,OAEgBxG,EAAAlC,EAAAkC,SAGlB6E,EAAOvN,KAAQiJ,MAAI,SAAEkG,GACnBrQ,IAAM2M,EAAI,IAAInD,EAAM,CAClBG,MAAO0G,WACPzG,IAEEuG,GAAWA,EAAUxD,EAC3B,IAAGrC,OAAM,SAACgG,GACJF,GAAQA,EAAOE,EACrB,GAEF,EDbE7B,OAAQ,CAAqC"}